---
title: "Test"
author: "Dana Aspel"
date: "2025-08-19"
output: html_document
runtime: shiny
---

This app uses:

-   **`faithful`** --- a built-in dataset in base R (no package needed)
-   **`shinyAppDir()`** --- a function from the shiny package
-   **`system.file()`** --- a base R function

## Packages and dependencies

List of packages and dependencies used in this Rmd:

-   **`base R`** (for everything else)
-   **`shiny`**
-   **`dplyr`**
-   **`tidyr`**
-   **`data.table`**
-   **`lattice`**

Other working packages:

|         |                |          |         |          |         |
|---------|----------------|----------|---------|----------|---------|
| stringi | shinydashboard | jsonlite | stringr | httr     | shinyjs |
| .sf     | leaflet        | DT       | readxl  | openxlsx |         |

### Failed dependencies

| Package   | Sub-Dependency | Error Code    | Req. Version |
|-----------|----------------|---------------|--------------|
| plotly    | MASS           | exit status 1 | R \>= 4.4.0  |
| forecast  | MASS           | exit status 1 | R \>= 4.4.0  |
| ggplot2   | MASS           | exit status 1 | R \>= 4.4.0  |
| car       | MASS           | exit status 1 | R \>= 4.4.0  |
| caret     | MASS           | exit status 1 | R \>= 4.4.0  |
| EnvStats  | MASS           | exit status 1 | R \>= 4.4.0  |
| tidyverse | MASS           | exit status 1 | R \>= 4.4.0  |
| lubridate | MASS           | exit status 1 | R \>= 4.4.0  |
| tidytext  | Matrix         | exit status 1 | R \>= 4.4.0  |

```{r setup, include=FALSE}
library(shiny)
library(dplyr) 
library(tidyr) 
library(data.table)
library(lattice)
library(plotly)
```

This R Markdown document is made interactive using Shiny. This uses the dataset Faithful, which contains a record of Old Faithful geyser, Yellowstone, eruptions.

## Data Prep

The dataset is first filtered to include only geyser eruptions longer than three minutes. These durations are then rounded to the nearest half-minute to simplify grouping. The number of occurrences for each rounded duration is counted, and the results are reshaped into a wide format for easier comparison.

```{r data_summary, echo=FALSE}

output$summaryTable <- renderTable({ faithful %>% filter(eruptions > 3) %>%
mutate(rounded = round(eruptions * 2) / 2) %>% count(rounded) %>% pivot_wider(names_from = rounded, values_from = n, values_fill = 0) %>% as.data.table() })
tableOutput("summaryTable")
```

## Eruptions

Old Faithful geyser eruption duration.

```{r eruptions, echo=FALSE}
inputPanel(
  selectInput("n_breaks", label = "Number of bins:",
              choices = c(10, 20, 35, 50), selected = 20),
  
  sliderInput("bw_adjust", label = "Bandwidth adjustment:",
              min = 0.2, max = 2, value = 1, step = 0.2)
)

renderPlot({
  hist(faithful$eruptions, probability = TRUE, breaks = as.numeric(input$n_breaks),
       xlab = "Duration (minutes)", main = "Geyser eruption duration")
  
  dens <- density(faithful$eruptions, adjust = input$bw_adjust)
  lines(dens, col = "blue")
})
```

## Statistical Application

This uses the system file 06_tabsets to create a Shiny application.

```{r tabsets, echo=FALSE}
shinyAppDir(
  system.file("examples/06_tabsets", package = "shiny"),
  options = list(
    width = "100%", height = 550
  )
)
```

## Eruption vs. Waiting Time (Lattice)

This plot uses the \`lattice\` package to show the relationship between eruption duration and waiting time between eruptions.

```{r lattice_plot, echo=FALSE}
output$latticePlot <- renderPlot({
  xyplot(waiting ~ eruptions, data = faithful,
         xlab = "Eruption Duration (minutes)",
         ylab = "Waiting Time (minutes)",
         main = "Old Faithful Eruption vs. Waiting Time")
})

plotOutput("latticePlot")
```

## Plotly for Interactive Plots 

This plot uses the \`plotly\` package to create an interactive histogram of geyser eruption durations. Users can zoom, pan, and hover to explore the data.

This has been disabled due to breaking of the app in Posit Connect. Requires MASS install.

```{r plotly_histogram, echo=FALSE}

output$plotlyHist <- renderPlotly({
  plot_ly(x = ~faithful$eruptions, type = "histogram",
          nbinsx = as.numeric(input$n_breaks)) %>%
    layout(title = "Interactive Geyser Eruption Histogram",
           xaxis = list(title = "Duration (minutes)"),
           yaxis = list(title = "Count"))
})

plotlyOutput("plotlyHist")

```
